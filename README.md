# Обработка для сравнения кода в режиме 1С:Предприятие

![Платформа 1С](https://img.shields.io/badge/1с_platform-8.3.20.1838-yellow.svg)
[![GitHub release](https://img.shields.io/github/release/vandalsvq/1c_code_diff.svg)](https://github.com/vandalsvq/1c_code_diff/releases)

Обработка предназначеня для сравнения кода в режиме 1С:Предприятие без использования внешних компонент.

![Главное окно](imgs/main.png)

## Возможности

* построение структуры модуля (дерево областей и методов)
* построчное сравнение текстов модулей
* подсветка наличия изменений, добавленных и удаленных строк

## Планируемые доработки 

* переключение вида с дерева на таблицу методов (без структуры)
* подсветка изменений комментариев к методам
* подсветка изменений Асинх и Экспорт
* вывод информации о типах методов
* анализ изменений без привязки к методам (например комментарии в коде)

## Дополнительная информация

* Минимальная версия платформы 8.3.18 (используются методы Асинх)
* Алгоритм построчного сравнения реализован на базе [разработки с Инфостарт](https://infostart.ru/public/581384/). Автор: Игорь Пашутин

### Методика сравнения:
* Сначала программа обрабатывает тексты модулей и "забивает" все комментарии и строковые значения (символом #), а так же заменяет ";"
* После подготовки текста программа строит дерево областей и методов
* При активизации строки метода, программа выполняет построчное сравнения и заносит данные в таблицы лево и право. Сравнение выполняется один раз, далее просто фильтруются строки

### Известные недостатки:
* Не учитывает объявление нового метода следом за закрытием предыдущего. Например: "КонецПроцедуры Процедура Имя()"
* Сравнение построчное. Внутри строки различия не анализируются и не подсвечиваются

### Быстродействие:
* Тестировалось на модулях 4-6 тысяч строк. При наличии разделения на методы (Процедура, Функция) сравнение выполняется достаточно быстро
* Предполагается, что тексты отдельных методов не будут превышать 1000 строк. Иначе из-за особенностей реализации методики построчного сравнения, расчет различий может выполняться длительное время
* Построчный анализ различий не выполняется до момента активизации строки метода в структуре модуля. При повторной активизации, анализ не выполняется, просто накладывается фильтр на таблицы

### Про батарейки
В обработке используются некоторые процедуры из общих модулей БСП. Обратите внимание "batteries not included", поэтому рекомендую открывать в конфигурациях, основанных на БСП.

Использованные объекты из БСП:
* ОМ.ОбщегоНазначения
* ОМ.ОбщегоНазначенияКлиент
* ОМ.ОбщегоНазначенияКлиентСервер
* ОМ.СтроковыеФункцииКлиентСервер
* ОМ.ФайловаяСистемаКлиент